extends layout

block content
  .overflow-hidden.bg-white.shadow.mt-5(class='rounded-lg').p-4
    dl.divide-y.divide-gray-200
      .pb-4.pt-2(class='sm:grid sm:grid-cols-3 sm:gap-4 sm:pb-5')
        dt.text-sm.font-medium.text-gray-500.self-center Username
        dd.mt-1.flex.text-sm.text-gray-900(class='sm:col-span-2 sm:mt-0')
          span.flex-grow.self-center=user.username
      .py-4(class='sm:grid sm:grid-cols-3 sm:gap-4 sm:py-5')
        dt.text-sm.font-medium.text-gray-500 Password
        dd.mt-1.flex.text-sm.text-gray-900(class='sm:col-span-2 sm:mt-0')
          span.flex-grow.self-center ********
      .py-4(class='sm:grid sm:grid-cols-3 sm:gap-4 sm:py-5')
        dt.text-sm.font-medium.text-gray-500 Role
        dd.mt-1.flex.text-sm.text-gray-900(class='sm:col-span-2 sm:mt-0')
          if (userpermissions.admin)
            span.flex-grow.text-red-800=user.role_name
          else
            span.flex-grow=user.role_name
      .py-4(class='sm:grid sm:grid-cols-3 sm:gap-4 sm:py-5')
        dt.text-sm.font-medium.text-gray-500 Permissions
        dd.mt-1.flex.text-sm.text-gray-900(class='sm:col-span-2 sm:mt-0')
          span.flex-grow
            each permission in Object.keys(permissions)
              if (permissions[permission] == true)
                span=permission + ": "
                span.text-green-600=permissions[permission]
                br
  .overflow-hidden.bg-white.shadow.mt-5(class='rounded-lg').p-4
    div(class='md:grid md:grid-cols-3 md:gap-6')
      div(class='md:col-span-1')
        .px-0(class='sm:px-0')
          h3.text-lg.font-medium.leading-6.text-gray-900.font-bold Change Username
      .mt-5(class='md:col-span-2 md:mt-0')
        div(class='focus:outline-none')
            form.space-y-6(action='#', method='POST')
              div
                label.block.text-sm.font-medium.text-gray-700(for='username_new') New Username
                .mt-1
                  input#username_new.block.w-full.appearance-none.rounded-md.border.border-gray-300.px-3.py-2.placeholder-gray-400.shadow-sm(name='username_new', type='text', required='', class='focus:border-emerald-500 focus:outline-none focus:ring-emerald-500 sm:text-sm')
              div
                button#username_new_submit.flex.w-full.justify-center.rounded-md.border.border-transparent.bg-emerald-600.py-2.px-4.text-sm.font-medium.text-white.shadow-sm(type='submit', class='hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2') Change Username
        .border-l-4.border-red-400.bg-red-50.p-4.mt-4#username_fail_banner.hidden
          .flex
            .flex-shrink-0
              // Heroicon name: mini/exclamation-triangle
              svg.h-5.w-5.text-red-400(xmlns='http://www.w3.org/2000/svg', viewBox='0 0 20 20', fill='currentColor', aria-hidden='true')
                path(fill-rule='evenodd', d='M8.485 3.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 3.495zM10 6a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 6zm0 9a1 1 0 100-2 1 1 0 000 2z', clip-rule='evenodd')
            .ml-3
              p#username_fail_banner_text.text-sm.text-red-700 Error Message
        .border-l-4.border-green-400.bg-green-50.p-4.mt-4#username_success_banner.hidden
          .flex
            .flex-shrink-0
              // Heroicon name: mini/exclamation-triangle
              svg.text-green-400.w-6.h-6(xmlns='http://www.w3.org/2000/svg', fill='none', viewBox='0 0 24 24', stroke-width='1.5', stroke='currentColor')
                path(stroke-linecap='round', stroke-linejoin='round', d='M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z')
            .ml-3
              p.text-sm.text-green-700#username_success_banner_text Success Message
      .relative.col-span-3.my-4
        .absolute.inset-0.flex.items-center(aria-hidden='true')
          .w-full.border-t.border-gray-300
      div(class='md:col-span-1')
        .px-0.pt-4(class='sm:px-0 md:pt-0')
          h3.text-lg.font-medium.leading-6.text-gray-900.font-bold Change Password
      .mt-5(class='md:col-span-2 md:mt-0')
        div(class='focus:outline-none')
            form.space-y-6(action='#', method='POST')
              div
                label.block.text-sm.font-medium.text-gray-700(for='password_new') Current Password
                .mt-1
                  input#password_old.block.w-full.appearance-none.rounded-md.border.border-gray-300.px-3.py-2.placeholder-gray-400.shadow-sm(name='password', type='password', autocomplete='current-password', required='', class='focus:border-emerald-500 focus:outline-none focus:ring-emerald-500 sm:text-sm')
              .space-y-1
                label.block.text-sm.font-medium.text-gray-700(for='password_new') New Password
                .mt-1
                  input#password_new.block.w-full.appearance-none.rounded-md.border.border-gray-300.px-3.py-2.placeholder-gray-400.shadow-sm(name='password', type='password', autocomplete='current-password', required='', class='focus:border-emerald-500 focus:outline-none focus:ring-emerald-500 sm:text-sm')
              .space-y-1
                label.block.text-sm.font-medium.text-gray-700(for='password_new_confirm') Confirm Password
                .mt-1
                  input#password_new_confirm.block.w-full.appearance-none.rounded-md.border.border-gray-300.px-3.py-2.placeholder-gray-400.shadow-sm(name='password', type='password', autocomplete='current-password', required='', class='focus:border-emerald-500 focus:outline-none focus:ring-emerald-500 sm:text-sm')
              div
                button#password_new_submit.flex.w-full.justify-center.rounded-md.border.border-transparent.bg-emerald-600.py-2.px-4.text-sm.font-medium.text-white.shadow-sm(type='submit', class='hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2') Change Password
        .border-l-4.border-red-400.bg-red-50.p-4.mt-4#password_fail_banner.hidden
          .flex
            .flex-shrink-0
              // Heroicon name: mini/exclamation-triangle
              svg.h-5.w-5.text-red-400(xmlns='http://www.w3.org/2000/svg', viewBox='0 0 20 20', fill='currentColor', aria-hidden='true')
                path(fill-rule='evenodd', d='M8.485 3.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 3.495zM10 6a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 6zm0 9a1 1 0 100-2 1 1 0 000 2z', clip-rule='evenodd')
            .ml-3
              p#password_fail_banner_text.text-sm.text-red-700 Error Message
        .border-l-4.border-green-400.bg-green-50.p-4.mt-4#password_success_banner.hidden
          .flex
            .flex-shrink-0
              // Heroicon name: mini/exclamation-triangle
              svg.text-green-400.w-6.h-6(xmlns='http://www.w3.org/2000/svg', fill='none', viewBox='0 0 24 24', stroke-width='1.5', stroke='currentColor')
                path(stroke-linecap='round', stroke-linejoin='round', d='M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z')
            .ml-3
              p#password_success_banner_text.text-sm.text-green-700 Success Message


    script.
      let qrefresh = false;
      document.getElementById("username_new_submit").addEventListener("click", function(event) {
        event.preventDefault();
        let data = {
          username: document.getElementById("username_new").value,
        }
        $.ajax({
          type: 'PUT',
          url: "/api/auth/user/update/username",
          contentType: "application/json",
          data: JSON.stringify(data)
        }).done(function (data, textStatus, xhr) {
          document.getElementById("username_fail_banner").classList.add("hidden");
          document.getElementById("username_success_banner_text").innerHTML = xhr.responseJSON.message;
          document.getElementById("username_success_banner").classList.remove("hidden");
          setTimeout(function() {
            location.reload();
          }, 1000);
        }).fail(function (data, textStatus, xhr) {
          document.getElementById("username_success_banner").classList.add("hidden");
          document.getElementById("username_fail_banner_text").innerHTML = data.responseJSON.message;
          document.getElementById("username_fail_banner").classList.remove("hidden");
        })
      })
      document.getElementById("password_new_submit").addEventListener("click", function(event) {
        event.preventDefault();
        let data = {
          old_password: document.getElementById("password_old").value,
          new_password: document.getElementById("password_new").value,
          new_password_confirm: document.getElementById("password_new_confirm").value
        }
        $.ajax({
          type: "PUT",
          url: "/api/auth/user/update/password",
          contentType: "application/json",
          data: JSON.stringify(data)
        }).done(function (data, textStatus, xhr) {
          document.getElementById("password_fail_banner").classList.add("hidden");
          document.getElementById("password_success_banner_text").innerHTML = xhr.responseJSON.message;
          document.getElementById("password_success_banner").classList.remove("hidden");
          setTimeout(function () {
            location.reload();
          }, 1000);
        }).fail(function (data, textStatus, xhr) {
          document.getElementById("password_success_banner").classList.add("hidden");
          document.getElementById("password_fail_banner_text").innerHTML = data.responseJSON.message;
          document.getElementById("password_fail_banner").classList.remove("hidden");
        })
      })
